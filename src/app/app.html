
<main class="min-h-screen bg-slate-50">
  <header class="bg-white border-b border-slate-200 px-8 py-4">
    <div class="flex flex-wrap items-center justify-between gap-6">
      <div class="flex items-center gap-4">
        <span class="text-4xl" aria-label="Bank Logo">üè¶</span>
        <div>
          <h1 class="text-xl font-bold text-slate-900">Banking Microservices</h1>
          <p class="text-sm text-slate-600">Enterprise Platform &middot; Phase 1: Gateway Integration</p>
        </div>
      </div>
      
      <nav class="flex gap-6 items-center" aria-label="Main Navigation">
        <a routerLink="/" routerLinkActive="bg-blue-600 text-white" 
           class="px-3 py-1 rounded font-medium text-blue-600 hover:bg-blue-600 hover:text-white transition-colors">Dashboard</a>
        <a routerLink="/accounts" routerLinkActive="bg-blue-600 text-white" 
           class="px-3 py-1 rounded font-medium text-blue-600 hover:bg-blue-600 hover:text-white transition-colors">Accounts</a>
        <a routerLink="/transactions" routerLinkActive="bg-blue-600 text-white" 
           class="px-3 py-1 rounded font-medium text-blue-600 hover:bg-blue-600 hover:text-white transition-colors">Transactions</a>
        <a routerLink="/profile" routerLinkActive="bg-blue-600 text-white" 
           class="px-3 py-1 rounded font-medium text-blue-600 hover:bg-blue-600 hover:text-white transition-colors">Profile</a>
      </nav>
      
      <div class="px-3 py-1 bg-sky-100 text-sky-700 rounded-full text-xs font-semibold ring-2 ring-sky-200" aria-live="polite">
        Woundex
      </div>
    </div>
  </header>

  <section class="max-w-4xl mx-auto px-4 py-12 min-h-[60vh]" aria-label="Main Content">
    <div class="bg-white rounded-lg shadow-sm border border-slate-200 overflow-hidden">
      <div class="px-6 py-6 border-b border-slate-200 bg-slate-50">
        <h2 class="text-lg font-semibold text-slate-900 mb-2">üîå API Gateway Connectivity Test</h2>
        <p class="text-sm text-slate-600">Click the button below to send a request through Port 8080 to the User Microservice.</p>
      </div>
      
      <div class="px-6 py-6">
        <button 
          (click)="testGatewayConnection(); $event.stopPropagation()"
          [disabled]="isLoading()"
          [attr.aria-busy]="isLoading()"
          aria-label="Test Gateway Connection"
          type="button"
          class="bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-md transition-colors disabled:opacity-70 disabled:cursor-not-allowed">
          @if (!isLoading()) {
            <span>Test Connection</span>
          } @else {
            <span>Connecting...</span>
          }
        </button>
        
        <p class="mt-4 text-sm text-gray-600">Debug: isLoading = {{ isLoading() }}, status = {{ connectionStatus() }}</p>

        @if (isLoading()) {
          <div class="mt-6 flex items-center gap-3" aria-live="polite">
            <div class="animate-spin h-5 w-5 border-2 border-blue-600 border-t-transparent rounded-full" aria-hidden="true"></div>
            <p class="text-slate-700">Handshaking with Gateway...</p>
          </div>
        }

        @if (connectionStatus() === 'SUCCESS') {
          <div class="mt-6 p-4 bg-green-50 text-green-800 rounded-md">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-xl">‚úÖ</span> 
              <strong class="font-semibold">Connection Established</strong>
            </div>
            <p class="text-sm mb-3">Successfully retrieved JWT from User Service via Gateway.</p>
            <pre class="bg-white/50 p-4 rounded text-xs overflow-x-auto font-mono">{{ apiResponse() | json }}</pre>
          </div>
        }

        @if (connectionStatus() === 'ERROR') {
          <div class="mt-6 p-4 bg-red-50 text-red-800 rounded-md">
            <div class="flex items-center gap-2 mb-2">
              <span class="text-xl">‚ùå</span> 
              <strong class="font-semibold">Connection Failed</strong>
            </div>
            <p class="text-sm mb-3">Could not reach the Gateway. Check if Docker containers are up.</p>
            <pre class="bg-white/50 p-4 rounded text-xs overflow-x-auto font-mono">{{ apiResponse() | json }}</pre>
          </div>
        }
      </div>
    </div>
  </section>

  <router-outlet></router-outlet>

  <footer class="bg-slate-100 text-slate-600 text-center py-4 border-t border-slate-200 mt-8">
    <div class="text-sm">
      &copy; {{ '2025' }} Banking Microservices Platform &mdash; Powered by Woun-dex
    </div>
  </footer>
</main>